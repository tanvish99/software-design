<p-toast></p-toast>
<p-confirmDialog></p-confirmDialog>

<div class="p-4 md:p-6">
    
    <div class="flex justify-between items-center mb-6">
        <div>
            <h1 class="text-2xl font-semibold">Budgets</h1>
            <p class="text-sm text-muted-color">Set and track monthly spending limits.</p>
        </div>

        <button 
            pButton 
            label="Add Budget" 
            icon="pi pi-plus" 
            class="p-button-primary"
            (click)="openAddDialog()">
        </button>
    </div>

    <p-card class="shadow-md">
        
        <!-- Budgets Table -->
        <p-table [value]="budgets" responsiveLayout="scroll">

            <ng-template pTemplate="header">
                <tr>
                    <th>Category</th>
                    <th>Budget</th>
                    <th>Spent</th>
                    <th>Progress</th>
                    <th class="text-center">Actions</th>
                </tr>
            </ng-template>

            <ng-template pTemplate="body" let-b>
                <tr>
                    <td>{{ b.category }}</td>
                    <td>${{ b.amount }}</td>
                    <td>${{ b.spent }}</td>

                    <td class="w-64">
                        <p-progressBar 
                        [value]="getPercentage(b)" 
                        [showValue]="true"
                        [style]="{'height':'20px'}"
                        [color]="getProgressColor(b)">
                        </p-progressBar>
                    </td>

                    <td class="text-center flex gap-2 justify-center">
                        <button 
                            pButton 
                            icon="pi pi-pencil" 
                            class="p-button-rounded p-button-text"
                            (click)="openEditDialog(b)">
                        </button>

                        <button 
                            pButton 
                            icon="pi pi-trash" 
                            class="p-button-rounded p-button-danger p-button-text"
                            (click)="confirmDelete(b)">
                        </button>
                    </td>
                </tr>
            </ng-template>

            <ng-template pTemplate="emptymessage">
        <tr>
          <td colspan="5" class="text-center py-4">
            No Budgets found. Click <strong>Add Budget</strong> to create one.
          </td>
        </tr>
      </ng-template>

        </p-table>

    </p-card>

</div>

<!-- ===== Add/Edit Dialog ===== -->
<p-dialog 
    [(visible)]="dialogVisible"
    [modal]="true"
    header="{{ dialogTitle }}"
    [style]="{width: '90vw', maxWidth: '450px'}"
    [draggable]="false"
    [resizable]="false">

    <form [formGroup]="budgetForm" class="space-y-4">

        <div>
            <label class="text-sm font-medium">Category</label>
            <p-select 
                appendTo="body"
                formControlName="category"
                [options]="categoryOptions"
                optionLabel="label"
                optionValue="value"
                class="w-full">
            </p-select>
        </div>

        <div>
            <label class="text-sm font-medium">Budget Amount</label>
            <p-inputNumber 
                formControlName="amount"
                mode="decimal"
                [minFractionDigits]="0"
                [maxFractionDigits]="0"
                class="w-full">
            </p-inputNumber>
        </div>

    </form>

    <ng-template pTemplate="footer">
        <button pButton label="Cancel" class="p-button-text" (click)="dialogVisible = false"></button>
        <button pButton label="Save" icon="pi pi-check" class="p-button-primary" (click)="saveBudget()"></button>
    </ng-template>

</p-dialog>